#!/bin/sh
#
# single        Script for sedding up administrative/rescue shell.
#
# chkconfig: 1 00 00
# description:	This file is executed by init when it goes into runlevel \
#               1, which is the administrative state. It kills all \
#               deamons and then puts the system into single user mode. \
#               Note that the file systems are kept mounted. \
#
# Author:       Miquel van Smoorenburg, <miquels@drinkel.nl.mugnet.org>
#               Modified for PLD Linux by Grzegorz Stanislawski
#

# Set the path.
PATH=/sbin:/bin:/usr/sbin:/usr/bin

case "$1" in
   stop*)
	exit 0
	;;
   start*)
# Kill all processes.
	[ "${BASH+bash}" = bash ] && enable kill

	echo "Sending all processes the TERM signal..."
	kill -15 -1
	sleep 5
	echo "Sending all processes the KILL signal.."
	kill -9 -1

	rm -f /var/lock/subsys/*

	# this looks nices
	[ -x /usr/bin/clear ] && /usr/bin/clear

	## we just killed kerneld :-(
	#/etc/rc.d/init.d/kerneld start

	# Now go to the single user level.
	echo "Telling INIT to go to single user mode."
	exec init -t1 S
	;;
esac
