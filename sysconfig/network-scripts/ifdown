#!/bin/sh
PATH=/sbin:/usr/sbin:/bin:/usr/bin

cd /etc/sysconfig/network-scripts
. /etc/rc.d/init.d/functions.network

CONFIG=$1

[ -z "$CONFIG" ] && {
    echo "usage: ifdown <device name>" >&2
    exit 1
}

[ -f "/etc/sysconfig/interfaces/$CONFIG" ] || CONFIG=ifcfg-$CONFIG
[ -f "/etc/sysconfig/interfaces/$CONFIG" ] || {
    echo "usage: ifdown <device name>" >&2
    exit 1
}

if [ `id -u` != 0 ]; then
    if [ -x /usr/sbin/usernetctl ]; then
        exec /usr/sbin/usernetctl $CONFIG down
    fi
    echo "Users cannot control this device." >&2
    exit 1
fi

source_config

if [ -z "$PREFIX" ] && [ -n "$NETMASK" ]; then
    PREFIX="`calcprefix $NETMASK`"
fi

if [ -z "$NETMASK" ] && [ -n "$PREFIX" ]; then
    NETMASK="`calcnetmask $PREFIX`"
fi

FULLDEVNAME="$DEVICE"
DEVICETYPE=`echo $FULLDEVNAME | sed "s/[0-9]*$//"`
DEVICE=`echo $FULLDEVNAME | sed 's/:.*//g'`
OTHERSCRIPT="/etc/sysconfig/network-scripts/ifdown-${DEVICETYPE}"

if [ -x $OTHERSCRIPT ]; then
	$OTHERSCRIPT $CONFIG $2
	exit $?
fi

if echo $DEVICE | grep -q ':' ; then
    ISALIAS=yes
else
    ISALIAS=no
fi

if [ "$ISALIAS" == "yes" ]; then
    ip addr del ${IPADDR}/${PREFIX} dev ${DEVICE}
else
    ip link set ${DEVICE} down
    ip addr flush dev ${DEVICE} 2> /dev/null
fi


exec /etc/sysconfig/network-scripts/ifdown-post $CONFIG

