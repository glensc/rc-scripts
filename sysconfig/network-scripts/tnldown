#!/bin/sh
#
#	$Id: tnldown,v 1.4 1999/07/29 13:59:37 misiek Exp $
#
# Author: Arkadiusz Mi¶kiewicz <misiek@pld.org.pl>
#
# Uwagi:
# - przy dodawaniu routingu w ifup pamiêtac o "onlink" (patrz dokumentacja do iproute)
# - gdzie¶ trzeba umie¶ciæ modprobe ipip && modprobe ip_gre
#

cd /etc/sysconfig/network-scripts
. /etc/rc.d/init.d/functions.network
. /etc/sysconfig/network

CONFIG=$1

[ -z "$CONFIG" ] && {
    echo "usage: tnldown <device name>" >&2
    exit 1
}

[ -f "/etc/sysconfig/interfaces/$CONFIG" ] || CONFIG=tnlcfg-$CONFIG
[ -f "/etc/sysconfig/interfaces/$CONFIG" ] || {
    echo "usage: tnldown <device name>" >&2
    exit 1
}

source_config

if [ "foo$2" = "fooboot" -a "${ONBOOT}" = "no" ]
then
        exit
fi

if [ "$IPV6_TUNNELCONFIG" != "yes" ] && [ "$MODE" == "sit" ] ||
   [ "$IPX" != "yes" ] && [ "$MODE" == "ipxip" ] || [ "$IPX" != "yes" ] && [ "$MODE" == "ipipx" ]
then
        exit
fi

if [ "${MODE}" == "ipip" ] || [ "${MODE}" == "sit" ] || [ "${MODE}" == "gre" ]; then

	ip tunnel del ${DEVICE}

elif [ "${MODE}" == "ipxip" ] || [ "${MODE}" == "ipipx" ]; then

echo "obs³uga ipxip jeszcze nie zrobiona"

fi
